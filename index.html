<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Rating</title>
<meta name="description" content="Local-only rating kiosk." />
<style>
    :root { --bg:#0f1113; --panel:#1a1d22; --panel-alt:#1d242b; --text:#f5f7fa; --muted:#9aa3ad; --accent:#ffcc33; --accent-glow:rgba(255,204,51,.55); --danger:#ff4d4f; --radius:40px; --focus:0 0 0 3px rgba(255,204,51,.45); --star-size:clamp(48px,7.5vw,72px); --avg-star-size:clamp(60px,11vw,110px); font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color-scheme: dark; --outline:#56616b; }
    .theme-light { --bg:#f5f6f8;--panel:#ffffff;--panel-alt:#eceff1;--text:#1d242c;--muted:#5a6672;--accent:#d18f00;--accent-glow:rgba(209,143,0,.55);--danger:#d13a3c;--focus:0 0 0 3px rgba(209,143,0,.35);color-scheme: light; --outline:#5a6672; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    body{min-height:100vh;display:flex;justify-content:center;padding:1.3rem}
    /* Product name larger than everything else */
    h1#headingMain{margin:.25rem 0 .55rem;font-weight:800;line-height:1.03;font-size:clamp(3rem,6vw,4.6rem);text-align:center;letter-spacing:.85px}
    .rating-text{margin:.25rem 0 0;text-align:center;font-size:clamp(1.05rem,1.4vw,1.3rem);font-weight:600;letter-spacing:.6px}
    .wrap{width:100%;max-width:1180px;display:flex;flex-direction:column;gap:1.15rem}
    .panel{background:var(--panel);border:1px solid #22292f;padding:1.05rem clamp(.9rem,3vw,3.2rem) 2.9rem;border-radius:var(--radius);box-shadow:0 12px 40px -12px rgba(0,0,0,.65),0 2px 6px rgba(0,0,0,.4);position:relative;overflow:hidden;transition:background .4s,border-color .4s,color .4s}
    .panel.rating-active{padding-bottom:2.3rem}
    /* Themed panel contrast & elevation (scoped to html root) */
    html:not(.theme-light) .panel{background:#161a1f;border-color:#2a3239;box-shadow:0 18px 44px -14px rgba(0,0,0,.72),0 3px 8px rgba(0,0,0,.45);} 
    html.theme-light .panel{background:#ffffff;border-color:#d8dde1;box-shadow:0 16px 40px -14px rgba(0,0,0,.28),0 4px 10px rgba(0,0,0,.18);} 
    .top-bar{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:.35rem;transition:opacity .4s ease,transform .4s ease}
    .top-bar.autohide{opacity:0;pointer-events:none;transform:translateY(-24px)}
    .bar-group{display:flex;align-items:center;gap:.7rem;flex-wrap:wrap}
    .hidden{display:none!important}
    /* Average stars (hero) */
    .average-block{margin-bottom:1.6rem}
    .avg-stars{display:flex;justify-content:center;gap:1.15rem;align-items:center;flex-wrap:nowrap;margin:.2rem 0 .45rem}
    .fraction-wrap{position:relative;width:var(--avg-star-size);height:var(--avg-star-size);flex:0 0 auto}
    .fraction-wrap svg{width:100%;height:100%;display:block}
    .avg-line{font-size:clamp(2.3rem,4.5vw,3.8rem);font-weight:700;letter-spacing:.6px;text-shadow:0 2px 10px rgba(0,0,0,.4);line-height:1.05;margin:.45rem 0 0;text-align:center}
    .avg-line small{display:block;font-size:clamp(.7rem,.95vw,.9rem);font-weight:500;color:var(--muted);margin-top:.55rem;letter-spacing:.55px}
    /* Interactive stars */
    .section-label{margin:0 0 .5rem;text-align:center;font-size:clamp(1.1rem,1.7vw,1.45rem);font-weight:650;color:var(--muted);letter-spacing:.65px}
    .stars{display:flex;justify-content:center;align-items:center;gap:20px;user-select:none;touch-action:manipulation;margin:.25rem 0 .1rem;flex-wrap:nowrap;overflow-x:auto;scrollbar-width:none;transform:translateY(-4px)}
    .stars::-webkit-scrollbar{display:none}
    .star-btn{-webkit-tap-highlight-color:transparent;appearance:none;border:none;background:transparent;padding:6px;cursor:pointer;line-height:0;border-radius:20px;position:relative;transition:transform .12s,background .25s}
    .star-btn:focus-visible{outline:none;box-shadow:var(--focus)}
    .star-btn:active{transform:scale(.9)}
    .star-btn.on .star-base use{stroke:var(--accent)}
    .star-btn.pending .star-base use{stroke:var(--accent);filter:drop-shadow(0 0 4px var(--accent-glow))}
    .star-btn .star-base use{transition:stroke .28s}
    svg.star{width:var(--star-size);height:var(--star-size);display:block;overflow:visible;filter:drop-shadow(0 3px 6px rgba(0,0,0,.55))}
    .star-base use{stroke:var(--outline);stroke-width:2;fill:none;vector-effect:non-scaling-stroke}
    /* Interactive stars slightly softer */
    .stars .star-base use{opacity:.72;transition:opacity .25s}
    .stars .star-btn.on .star-base use,.stars .star-btn.pending .star-base use{opacity:1}
    .star-fill{opacity:0;transition:opacity .22s}
    .star-fill use{fill:var(--accent);stroke:var(--accent);stroke-width:0}
    /* Status / feedback (removed visual line) */
    .input-row{display:flex;flex-direction:column;gap:.7rem;max-width:520px;margin:1.6rem auto 0;text-align:center}
    .input-row input{background:var(--panel-alt);border:2px solid #273039;color:var(--text);padding:.95rem 1.15rem;font-size:1.3rem;border-radius:26px;text-align:center;letter-spacing:.55px;font-weight:600}
    .input-row input:focus{outline:none;box-shadow:var(--focus);border-color:var(--accent)}
    .input-row button{background:var(--accent);color:#222;font-size:1.05rem;font-weight:650;padding:.95rem 1.3rem;border:none;border-radius:999px;cursor:pointer;letter-spacing:.6px;box-shadow:0 6px 18px -6px rgba(0,0,0,.55)}
    .icon-btn{width:56px;height:56px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;background:var(--panel-alt);border:2px solid #22292f;cursor:pointer;transition:background .3s,transform .25s}
    .icon-btn:hover{background:#232a31}
    .icon-btn:focus-visible{outline:none;box-shadow:var(--focus)}
    .notice{text-align:center;margin-top:.1rem;font-size:.6rem;color:var(--muted);letter-spacing:.35px}
    .footer-logo{margin-top:2.2rem;display:flex;justify-content:center;opacity:.45;transition:opacity .3s}
    .footer-logo:hover{opacity:.65}
    /* Improve dark mode logo visibility */
    .footer-logo img{max-width:170px;width:28%;min-width:120px;filter:none;transition:filter .25s,opacity .25s}
    /* Simple theme handling: dark panel uses light logo via invert */
    html:not(.theme-light) .footer-logo img{filter:invert(1) brightness(1.1)}
    html.theme-light .footer-logo img{filter:brightness(.85) contrast(1.25) drop-shadow(0 1px 2px rgba(0,0,0,.2))}
    .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0 0 0 0) !important;white-space:nowrap !important;border:0 !important;}
    @media (max-width:780px){ h1#headingMain{font-size:clamp(2.7rem,9vw,3.6rem);} .avg-stars{gap:.65rem} .panel{padding:1.05rem 1rem 2.6rem} .footer-logo{margin-top:2rem} }
    .kbd-hint{margin-top:.65rem;text-align:center;font-size:.7rem;letter-spacing:.4px;color:var(--muted)}
    /* Status / feedback line (restored) */
    .status{min-height:1.1rem;text-align:center;font-size:.8rem;margin-top:.55rem;font-weight:600;letter-spacing:.45px;color:var(--muted);transition:color .3s}
</style>
</head>
<body>
<svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden"><symbol id="star-shape" viewBox="0 0 24 24"><path d="M12 2.4l2.9 6 6.6.9-4.9 4.8 1.2 6.6L12 17.9 6.2 20.7l1.2-6.6L2.5 9.3l6.6-.9L12 2.4z" /></symbol></svg>
<div class="wrap">
  <div class="panel" id="panel">
    <div class="top-bar">
      <div class="bar-group" id="leftTools">
        <button class="icon-btn" id="themeToggle" aria-label="Toggle theme"></button>
        <button class="icon-btn" id="fsToggle" aria-label="Fullscreen"></button>
      </div>
      <div style="flex:1"></div>
    </div>
    <h1 id="headingMain">Product Rating</h1>
    <div id="averageBlock" class="average-block hidden" aria-describedby="liveAnnouncer">
      <div id="avgStars" class="avg-stars" aria-hidden="true"></div>
      <div id="avgLine" class="avg-line">-- out of 5 Stars <small>with 0 Ratings</small></div>
    </div>
    <p id="subtitle" class="rating-text">Enter a name to begin</p>

    <div id="idInputWrapper" class="input-row hidden">
      <input id="idInput" placeholder="Product Name" maxlength="40" autocomplete="off" />
      <button id="startBtn" type="button">Start</button>
      <div class="notice">Local demo only (stored in this browser).</div>
    </div>

    <div id="yourLabel" class="section-label hidden">Add Your Rating</div>
    <div id="starsContainer" class="stars hidden" role="radiogroup" aria-label="Select a star rating"></div>
    <div id="kbdHint" class="kbd-hint hidden">Press 1â€“5 or use arrow keys, Enter to save.</div>

    <div id="status" class="status" aria-live="polite"></div>
    <div id="liveAnnouncer" class="visually-hidden" aria-live="polite"></div>
    <div class="footer-logo"><img src="logo.svg" alt="Brand Logo" loading="lazy" /></div>
  </div>
</div>
<script>(function(){
  const themeToggle=document.getElementById('themeToggle');
  const fsToggle=document.getElementById('fsToggle');
  const docEl=document.documentElement;
  function themeIcon(){const light=docEl.classList.contains('theme-light');themeToggle.innerHTML=light?'<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="var(--text)" stroke-width="2"><path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z"/></svg>':'<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="var(--text)" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22 5.64 5.64M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>'; }
  function fsIcon(){const fs=document.fullscreenElement||document.webkitFullscreenElement;fsToggle.innerHTML=fs?'<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="var(--text)" stroke-width="2"><path d="M9 9l-4-4m0 0h5M5 5v5M15 15l4 4m0 0h-5m5 0v-5M9 15l-4 4m0 0h5M5 19v-5M15 9l4-4m0 0h-5m5 0v5"/></svg>':'<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="var(--text)" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m0 8v3a2 2 0 0 0 2 2h3m8-18h3a2 2 0 0 1 2 2v3m0 8v3a2 2 0 0 1-2 2h-3"/></svg>'; }
  const storedTheme=localStorage.getItem('standalone-theme'); if(storedTheme==='light') docEl.classList.add('theme-light'); themeIcon(); fsIcon();
  themeToggle.addEventListener('click',()=>{docEl.classList.toggle('theme-light');localStorage.setItem('standalone-theme',docEl.classList.contains('theme-light')?'light':'dark');themeIcon();});
  fsToggle.addEventListener('click',()=>{const fs=document.fullscreenElement||document.webkitFullscreenElement;if(!fs){const r=document.documentElement;(r.requestFullscreen||r.webkitRequestFullscreen).call(r);}else{(document.exitFullscreen||document.webkitExitFullscreen).call(document);} });
  document.addEventListener('fullscreenchange',fsIcon);

  const qs=new URLSearchParams(location.search); const idParam=qs.get('m')?.trim()||'';
  const heading=document.getElementById('headingMain');
  const subtitle=document.getElementById('subtitle');
  const yourLabel=document.getElementById('yourLabel');
  const idInputWrapper=document.getElementById('idInputWrapper');
  const idInput=document.getElementById('idInput');
  const startBtn=document.getElementById('startBtn');
  const starsContainer=document.getElementById('starsContainer');
  const avgLine=document.getElementById('avgLine');
  const avgStars=document.getElementById('avgStars');
  const averageBlock=document.getElementById('averageBlock');
  const liveAnnouncer=document.getElementById('liveAnnouncer');
  const statusDiv=document.getElementById('status'); // restored visual status line

  const STAR_COUNT=5; let currentId=''; let selected=0; let hoverVal=0; let pending=0;
  function storageKey(id){return `rating:mattress:${id}`}
  function loadAgg(id){try{const raw=localStorage.getItem(storageKey(id)); if(!raw) return {count:0,total:0,buckets:[0,0,0,0,0]}; const p=JSON.parse(raw); if(!Array.isArray(p.buckets)||p.buckets.length!==5) p.buckets=[0,0,0,0,0]; if(typeof p.count!=='number'||typeof p.total!=='number') return {count:0,total:0,buckets:[0,0,0,0,0]}; return p;}catch{return {count:0,total:0,buckets:[0,0,0,0,0]};} }
  function saveAgg(id,a){localStorage.setItem(storageKey(id),JSON.stringify(a))}
  function record(id,stars){const a=loadAgg(id); a.count++; a.total+=stars; a.buckets[stars-1]++; saveAgg(id,a); return a; }
  function fmtAvg(c,t){ if(c===0) return {txt:'--',v:0}; const v=t/c; return {txt:v.toFixed(2).replace(/\.00$/,'').replace(/(\.[0-9])0$/,'$1'),v}; }

  function buildStars(){
    starsContainer.innerHTML='';
    for(let i=1;i<=STAR_COUNT;i++){
      const b=document.createElement('button');
      b.className='star-btn'; b.type='button'; b.setAttribute('data-star',String(i));
      b.setAttribute('role','radio'); b.setAttribute('aria-label',`${i} star${i>1?'s':''}`);
      b.setAttribute('aria-checked','false');
      b.addEventListener('pointerenter',()=>{hoverVal=i; paintStars();});
      b.addEventListener('pointerleave',()=>{hoverVal=0; paintStars();});
      b.addEventListener('click',()=>{ if(!currentId){flash('Enter a name first.',true); return;} commitRating(i); });
      const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('aria-hidden','true'); svg.classList.add('star');
      const gBase=document.createElementNS('http://www.w3.org/2000/svg','g'); gBase.classList.add('star-base'); const baseUse=document.createElementNS('http://www.w3.org/2000/svg','use'); baseUse.setAttribute('href','#star-shape'); gBase.appendChild(baseUse);
      const gFill=document.createElementNS('http://www.w3.org/2000/svg','g'); gFill.classList.add('star-fill'); const fillUse=document.createElementNS('http://www.w3.org/2000/svg','use'); fillUse.setAttribute('href','#star-shape'); gFill.appendChild(fillUse);
      svg.append(gBase,gFill); b.append(svg); starsContainer.append(b);
    }
  }
  function commitRating(val){ selected=val; pending=0; const agg=record(currentId,val); flash('Saved!',false); updateUI(agg); setTimeout(()=>{selected=0; paintStars();},2600); paintStars(); if(kbdHint){kbdHint.classList.add('hidden');} }
  function paintStars(){
    [...starsContainer.children].forEach((b,idx)=>{
      const star=idx+1; const fill=b.querySelector('.star-fill');
      const active=(hoverVal? star<=hoverVal : (pending? star<=pending : (selected && star<=selected)));
      if(fill) fill.style.opacity=active?'1':'0';
      b.classList.toggle('on',selected && star<=selected);
      b.classList.toggle('pending',pending && star<=pending && !selected);
      b.setAttribute('aria-checked', selected===star ? 'true':'false');
      if(pending===star && !selected) b.setAttribute('aria-checked','true');
    });
  }

  let fractionalRenderRun=0;
  function tween(from,to,duration,step){ const start=performance.now(); function frame(t){ const prog=Math.min((t-start)/duration,1); const eased=prog<0.5?2*prog*prog:-1+(4-2*prog)*prog; step(from+(to-from)*eased); if(prog<1) requestAnimationFrame(frame);} requestAnimationFrame(frame);} 

  function renderFractional(v){
    avgStars.innerHTML='';
    fractionalRenderRun++; const run=fractionalRenderRun;
    for(let i=1;i<=STAR_COUNT;i++){
      const frac=Math.min(Math.max(v-(i-1),0),1);
      const wrap=document.createElement('div'); wrap.className='fraction-wrap'; wrap.dataset.frac=String(frac);
      const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 24 24');
      if(frac<=0){
        svg.innerHTML=`<use href='#star-shape' fill='none' stroke='var(--outline)' stroke-width='2'></use>`;
      } else if(frac>=1){
        svg.innerHTML=`<use href='#star-shape' fill='var(--accent)'></use><use href='#star-shape' fill='none' stroke='var(--accent)' stroke-width='2'></use>`;
      } else {
        const fw=(24*frac).toFixed(3); const cf=`clipF_${run}_${i}`;
        svg.innerHTML=`<defs><clipPath id='${cf}'><rect width='${fw}' height='24'></rect></clipPath></defs>
          <use href='#star-shape' fill='none' stroke='var(--outline)' stroke-width='2'></use>
          <g clip-path='url(#${cf})'>
            <use href='#star-shape' fill='var(--accent)'></use>
            <use href='#star-shape' fill='none' stroke='var(--accent)' stroke-width='2'></use>
          </g>`;
      }
      wrap.append(svg); avgStars.append(wrap);
    }
  }

  function updateUI(agg){ const {txt,v}=fmtAvg(agg.count,agg.total); heading.textContent=currentId; subtitle.classList.add('hidden'); yourLabel.classList.remove('hidden'); const ratingCount=agg.count?`with ${agg.count} Rating${agg.count===1?'':'s'}`:'be the first to rate'; avgLine.innerHTML=`${txt} out of 5 Stars <small>${ratingCount}</small>`; renderFractional(v); averageBlock.classList.remove('hidden'); starsContainer.classList.remove('hidden'); document.querySelector('.panel')?.classList.add('rating-active'); liveAnnouncer.textContent= agg.count ? `Average ${txt} stars from ${agg.count} rating${agg.count===1?'':'s'}.` : 'No ratings yet.'; }
  function flash(msg,err){ if(statusDiv){ statusDiv.textContent=msg; statusDiv.style.color= err ? 'var(--danger)' : 'var(--accent)'; if(!err) setTimeout(()=>{ if(statusDiv.textContent===msg) statusDiv.textContent=''; },2000); } if(liveAnnouncer){ liveAnnouncer.textContent=msg; } }
  function initId(id){ currentId=id; localStorage.setItem('last-product-name',id); buildStars(); updateUI(loadAgg(id)); paintStars(); }

  const last=localStorage.getItem('last-product-name'); if(!idParam){ idInputWrapper.classList.remove('hidden'); if(last) idInput.value=last; }
  if(idParam){ initId(idParam); }
  startBtn.addEventListener('click',()=>{ const val=idInput.value.trim(); if(!val){flash('Enter a name.',true);return;} const url=new URL(location.href); url.searchParams.set('m',val); history.replaceState({},'',url.toString()); idInputWrapper.classList.add('hidden'); initId(val); });

  const kbdHint=document.getElementById('kbdHint'); let hintShown=false; function showHint(){ if(hintShown||!kbdHint) return; kbdHint.classList.remove('hidden'); hintShown=true; }

  // Auto-hide top bar controls
  const topBar=document.querySelector('.top-bar'); let hideTopTimer=null; function scheduleHide(){ if(!topBar) return; clearTimeout(hideTopTimer); hideTopTimer=setTimeout(()=>{ topBar.classList.add('autohide'); },2600);} function showTopBar(){ if(!topBar) return; const wasHidden=topBar.classList.contains('autohide'); topBar.classList.remove('autohide'); clearTimeout(hideTopTimer); hideTopTimer=setTimeout(()=>{ topBar.classList.add('autohide'); }, wasHidden?3200:2600); }

  document.addEventListener('pointerdown',e=>{ if(e.clientY<90){ showTopBar(); }});
  document.addEventListener('mousemove',e=>{ if(e.clientY<50){ showTopBar(); }});
  topBar?.addEventListener('pointerenter',()=>{ clearTimeout(hideTopTimer); });
  topBar?.addEventListener('pointerleave',()=>{ scheduleHide(); });
  themeToggle.addEventListener('focus',showTopBar); fsToggle.addEventListener('focus',showTopBar);
  themeToggle.addEventListener('blur',scheduleHide); fsToggle.addEventListener('blur',scheduleHide);
  document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ showTopBar(); }});

  document.addEventListener('keydown',e=>{
    if(!currentId) return;
    if(['ArrowRight','ArrowUp','ArrowLeft','ArrowDown','1','2','3','4','5'].includes(e.key)) showHint();
    if(e.key>='1'&&e.key<='5'){ commitRating(Number(e.key)); return; }
    if(['ArrowRight','ArrowUp'].includes(e.key)){ e.preventDefault(); pending = pending? Math.min(5,pending+1) : 1; paintStars(); return; }
    if(['ArrowLeft','ArrowDown'].includes(e.key)){ e.preventDefault(); if(pending>1) pending--; else if(!pending) pending=5; else pending=0; paintStars(); return; }
    if(e.key==='Enter' && pending){ commitRating(pending); }
  });

  starsContainer.addEventListener('focusin',()=>{showHint();});
})();</script>
</body>
</html>
