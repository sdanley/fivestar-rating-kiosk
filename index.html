<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Rating</title>
<meta name="description" content="Local-only rating kiosk." />
<link rel="manifest" href="/manifest.webmanifest"> 
<!-- PWA / iOS install enhancements -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Rating">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<meta name="theme-color" content="#0f1113" />
<style>
    :root { --bg:#0f1113; --panel:#1a1d22; --panel-alt:#1d242b; --text:#f5f7fa; --muted:#9aa3ad; --accent:#ffcc33; --accent-glow:rgba(255,204,51,.55); --danger:#ff4d4f; --radius:40px; --focus:0 0 0 3px rgba(255,204,51,.45); --star-size:clamp(48px,7.5vw,72px); --avg-star-size:clamp(60px,11vw,110px); font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color-scheme: dark; --outline:#56616b; }
    .theme-light { --bg:#f5f6f8;--panel:#ffffff;--panel-alt:#eceff1;--text:#1d242c;--muted:#5a6672;--accent:#d18f00;--accent-glow:rgba(209,143,0,.55);--danger:#d13a3c;--focus:0 0 0 3px rgba(209,143,0,.35);color-scheme: light; --outline:#5a6672; }
    *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;height:100%;}
  body{min-height:100vh;min-height:100dvh;display:flex;justify-content:center;padding:1.3rem;touch-action:manipulation;overscroll-behavior:none;/* Use dynamic custom vh when set */min-height:var(--vh,100vh);padding:calc(1.3rem + env(safe-area-inset-top,0px)) calc(1.3rem + env(safe-area-inset-right,0px)) calc(1.3rem + env(safe-area-inset-bottom,0px)) calc(1.3rem + env(safe-area-inset-left,0px));}
  html{overscroll-behavior:none}
    h1#headingMain{margin:.25rem 0 .55rem;font-weight:800;line-height:1.03;font-size:clamp(3rem,6vw,4.6rem);text-align:center;letter-spacing:.85px}
    .rating-text{margin:.25rem 0 0;text-align:center;font-size:clamp(1.05rem,1.4vw,1.3rem);font-weight:600;letter-spacing:.6px}
  .wrap{width:100%;max-width:1180px;display:flex;flex-direction:column;gap:1.15rem;flex:1;}
    .panel{background:var(--panel);border:1px solid #22292f;padding:1.05rem clamp(.9rem,3vw,3.2rem) 2.9rem;border-radius:var(--radius);box-shadow:0 12px 40px -12px rgba(0,0,0,.65),0 2px 6px rgba(0,0,0,.4);position:relative;overflow:hidden;transition:background .4s,border-color .4s,color .4s}
  .panel{display:flex;flex-direction:column;flex:1;}
    .panel.rating-active{padding-bottom:2.3rem}
    html:not(.theme-light) .panel{background:#161a1f;border-color:#2a3239;box-shadow:0 18px 44px -14px rgba(0,0,0,.72),0 3px 8px rgba(0,0,0,.45);} 
    html.theme-light .panel{background:#ffffff;border-color:#d8dde1;box-shadow:0 16px 40px -14px rgba(0,0,0,.28),0 4px 10px rgba(0,0,0,.18);} 
    .top-bar{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:.35rem;transition:opacity .4s ease,transform .4s ease}
    .top-bar.autohide{opacity:0;pointer-events:none;transform:translateY(-24px)}
    .bar-group{display:flex;align-items:center;gap:.7rem;flex-wrap:wrap}
    .hidden{display:none!important}
    .average-block{margin-bottom:1.6rem}
    .avg-stars{display:flex;justify-content:center;gap:1.15rem;align-items:center;flex-wrap:nowrap;margin:.2rem 0 .45rem}
    .fraction-wrap{position:relative;width:var(--avg-star-size);height:var(--avg-star-size);flex:0 0 auto}
    .fraction-wrap svg{width:100%;height:100%;display:block}
    .avg-line{font-size:clamp(2.3rem,4.5vw,3.8rem);font-weight:700;letter-spacing:.6px;text-shadow:0 2px 10px rgba(0,0,0,.4);line-height:1.05;margin:.45rem 0 0;text-align:center}
    .avg-line small{display:block;font-size:clamp(.7rem,.95vw,.9rem);font-weight:500;color:var(--muted);margin-top:.55rem;letter-spacing:.55px}
    .section-label{margin:0 0 .5rem;text-align:center;font-size:clamp(1.1rem,1.7vw,1.45rem);font-weight:650;color:var(--muted);letter-spacing:.65px}
    .stars{display:flex;justify-content:center;align-items:center;gap:20px;user-select:none;touch-action:manipulation;margin:.25rem 0 .1rem;flex-wrap:nowrap;overflow-x:auto;scrollbar-width:none;transform:translateY(-4px)}
    .stars::-webkit-scrollbar{display:none}
    .star-btn{-webkit-tap-highlight-color:transparent;appearance:none;border:none;background:transparent;padding:6px;cursor:pointer;line-height:0;border-radius:20px;position:relative;transition:transform .12s,background .25s}
    .star-btn:focus-visible{outline:none;box-shadow:var(--focus)}
    .star-btn:active{transform:scale(.9)}
    .star-btn.on .star-base use{stroke:var(--accent)}
    .star-btn.pending .star-base use{stroke:var(--accent);filter:drop-shadow(0 0 4px var(--accent-glow))}
    .star-btn .star-base use{transition:stroke .28s}
    svg.star{width:var(--star-size);height:var(--star-size);display:block;overflow:visible;filter:drop-shadow(0 3px 6px rgba(0,0,0,.55))}
    .star-base use{stroke:var(--outline);stroke-width:2;fill:none;vector-effect:non-scaling-stroke}
    .stars .star-base use{opacity:.72;transition:opacity .25s}
    .stars .star-btn.on .star-base use,.stars .star-btn.pending .star-base use{opacity:1}
    .star-fill{opacity:0;transition:opacity .22s}
    .star-fill use{fill:var(--accent);stroke:var(--accent);stroke-width:0}
    .input-row{display:flex;flex-direction:column;gap:.7rem;max-width:520px;margin:1.6rem auto 0;text-align:center}
    .input-row input{background:var(--panel-alt);border:2px solid #273039;color:var(--text);padding:.95rem 1.15rem;font-size:1.3rem;border-radius:26px;text-align:center;letter-spacing:.55px;font-weight:600}
    .input-row input:focus{outline:none;box-shadow:var(--focus);border-color:var(--accent)}
    .input-row button{background:var(--accent);color:#222;font-size:1.05rem;font-weight:650;padding:.95rem 1.3rem;border:none;border-radius:999px;cursor:pointer;letter-spacing:.6px;box-shadow:0 6px 18px -6px rgba(0,0,0,.55)}
    .icon-btn{width:56px;height:56px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;background:var(--panel-alt);border:2px solid #22292f;cursor:pointer;transition:background .3s,transform .25s; color:var(--text);} /* added color for currentColor */
    .icon-btn svg{width:28px;height:28px;display:block;pointer-events:none;} /* ensure visible on iOS */
    .notice{text-align:center;margin-top:.1rem;font-size:.6rem;color:var(--muted);letter-spacing:.35px}
    .footer-logo{margin-top:2.2rem;display:flex;justify-content:center;opacity:.45;transition:opacity .3s}
    .footer-logo:hover{opacity:.65}
    /* Logo theming for inline SVG */
    .footer-logo svg{max-width:260px;width:38%;min-width:140px;display:block;color:rgba(255,255,255,.75)}
    html.theme-light .footer-logo svg{color:rgba(0,0,0,.65)}
    .footer-logo svg path{fill:currentColor}
    /* Remove old img-specific rules */
    /* .footer-logo img styles removed */
    .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0 0 0 0) !important;white-space:nowrap !important;border:0 !important;}
    @media (max-width:780px){ h1#headingMain{font-size:clamp(2.7rem,9vw,3.6rem);} .avg-stars{gap:.65rem} .panel{padding:1.05rem 1rem 2.6rem} .footer-logo{margin-top:2rem} }
  /* iPad / tablet full-bleed: remove max-width when class is present */
  html.ios-tablet .wrap{max-width:100%;}
  html.full-bleed .wrap{max-width:100%;}
    .kbd-hint{margin-top:.65rem;text-align:center;font-size:.7rem;letter-spacing:.4px;color:var(--muted)}
    .status{min-height:1.1rem;text-align:center;font-size:.8rem;margin-top:.55rem;font-weight:600;letter-spacing:.45px;color:var(--muted);transition:color .3s}
    /* Kiosk: disable text selection & callouts except for inputs */
    body.kiosk-no-select,body.kiosk-no-select *:not(input,textarea,[contenteditable],#status,.status){
      -webkit-user-select:none;user-select:none;-webkit-touch-callout:none;
    }
</style>
<link rel="manifest" href="manifest.webmanifest" crossorigin="use-credentials" />
<script>
// Kiosk: prevent pinch-zoom & double-tap zoom (iOS Safari)
(function(){
  const isiOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
  if(!isiOS) return; // Scope to iOS to avoid blocking accessibility zoom elsewhere
  // Block native gesture events
  ['gesturestart','gesturechange','gestureend'].forEach(type=>{
    document.addEventListener(type,e=>{ e.preventDefault(); }, {passive:false});
  });
  // Block multi-touch pinch via touchmove
  document.addEventListener('touchmove',e=>{ if(e.touches.length>1) e.preventDefault(); }, {passive:false});
  // Suppress double-tap to zoom
  let lastTouchEnd=0;
  document.addEventListener('touchend',e=>{ const now=Date.now(); if(now-lastTouchEnd<=400){ e.preventDefault(); } lastTouchEnd=now; }, true);
})();
// Kiosk: disable context menu + selection (except inputs)
document.addEventListener('DOMContentLoaded',()=>{
  document.body.classList.add('kiosk-no-select');
  document.addEventListener('contextmenu',e=>{ e.preventDefault(); }, {capture:true});
  // Kiosk: push a history state to trap back button
  try{ history.replaceState({kiosk:true},'',location.href); history.pushState({kiosk:true},'',location.href); }catch{}
});
// Kiosk: intercept back navigation (popstate)
window.addEventListener('popstate',e=>{ if(!e.state||!e.state.kiosk){ try{ history.pushState({kiosk:true},'',location.href);}catch{} } });
// Kiosk: prevent external navigation (open only same-origin and hash links)
document.addEventListener('click',e=>{
  const a=e.target.closest&&e.target.closest('a'); if(!a) return;
  const href=a.getAttribute('href'); if(!href||href.startsWith('#')) return;
  try { const url=new URL(href,location.href); if(url.origin!==location.origin){ e.preventDefault(); return; } } catch { e.preventDefault(); }
});
// Kiosk: suppress pull-to-refresh (iOS/Android)
let touchStartY=null; let maybePull=false;
document.addEventListener('touchstart',e=>{ if(e.touches.length!==1) return; touchStartY=e.touches[0].clientY; maybePull=(window.scrollY===0); }, {passive:true});
document.addEventListener('touchmove',e=>{ if(e.touches.length!==1) return; if(maybePull){ const dy=e.touches[0].clientY - touchStartY; if(dy>10){ e.preventDefault(); } } }, {passive:false});
// Dynamic viewport height (mobile Safari chrome hide/show)
(function(){
  function setVH(){ document.documentElement.style.setProperty('--vh', window.innerHeight + 'px'); }
  setVH(); window.addEventListener('resize', setVH); window.addEventListener('orientationchange', ()=>setTimeout(setVH,120));
  const ua=navigator.userAgent;
  const isiPad=/iPad/.test(ua) || (/(Macintosh).*Version\/.*Safari/.test(ua) && navigator.maxTouchPoints>1);
  if(isiPad) document.documentElement.classList.add('ios-tablet','full-bleed');
})();
</script>
</head>
<body>
<svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden"><symbol id="star-shape" viewBox="0 0 24 24"><path d="M12 2.4l2.9 6 6.6.9-4.9 4.8 1.2 6.6L12 17.9 6.2 20.7l1.2-6.6L2.5 9.3l6.6-.9L12 2.4z" /></symbol></svg>
<div class="wrap">
  <div class="panel" id="panel">
  <div id="netStatus" aria-live="polite" style="position:fixed;left:50%;top:8px;transform:translateX(-50%);background:#d13a3c;color:#fff;font-size:.75rem;padding:.4rem .7rem;border-radius:999px;letter-spacing:.5px;box-shadow:0 4px 14px -6px rgba(0,0,0,.5);display:none;z-index:50">OFFLINE</div>
  <div id="updateToast" style="position:fixed;left:50%;bottom:14px;transform:translateX(-50%);background:var(--panel-alt);color:var(--text);font-size:.72rem;padding:.55rem .9rem;border:1px solid #2a3239;border-radius:999px;letter-spacing:.55px;display:none;z-index:60;box-shadow:0 6px 16px -8px rgba(0,0,0,.55);cursor:pointer">Update ready – tap to refresh</div>
    <div id="verBadge" style="position:fixed;right:8px;bottom:8px;font-size:.55rem;font-weight:600;letter-spacing:.8px;padding:.3rem .5rem;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.12);border-radius:6px;color:var(--muted);z-index:40;pointer-events:none;opacity:.55">--</div>
    <script>
    // Early version badge fallback (iPad standalone quirk)
    (function(){
      const vb=document.getElementById('verBadge'); if(!vb) return;
      // If still unknown after 1s, try direct fetch (may run before main script finishes)
      setTimeout(()=>{
        if(vb.textContent && vb.textContent.trim()!=='--') return;
  // Try version.json first (updated per commit if deployed)
  fetch('/version.json',{cache:'no-store'}).then(r=>r.ok?r.json():null).then(j=>{ if(j && j.version){ vb.textContent='REV '+j.version; } }).catch(()=>{}).finally(()=>{
        fetch('/sw.js',{cache:'no-store'}).then(r=>r.text()).then(txt=>{
          const m=txt.match(/const\s+VERSION\s*=\s*['"]([^'"`]+)['"]/); if(m){ vb.textContent='REV '+m[1]; }
  }).catch(()=>{});
  });
      },1000);
    })();
    </script>
    <div class="top-bar">
      <div class="bar-group" id="leftTools">
        <button class="icon-btn" id="themeToggle" aria-label="Toggle theme"></button>
        <button class="icon-btn" id="fsToggle" aria-label="Fullscreen"></button>
      </div>
      <div style="flex:1"></div>
    </div>
    <h1 id="headingMain">Product Rating</h1>
    <div id="averageBlock" class="average-block hidden" aria-describedby="liveAnnouncer">
      <div id="avgStars" class="avg-stars" aria-hidden="true"></div>
      <div id="avgLine" class="avg-line">-- out of 5 Stars <small>with 0 Ratings</small></div>
    </div>
    <p id="subtitle" class="rating-text">Enter a name to begin</p>

    <div id="idInputWrapper" class="input-row hidden">
      <input id="idInput" placeholder="Product Name" maxlength="40" autocomplete="off" />
      <button id="startBtn" type="button">Start</button>
      <div class="notice">Local demo only (stored in this browser).</div>
    </div>

    <div id="yourLabel" class="section-label hidden">Add Your Rating</div>
    <div id="starsContainer" class="stars hidden" role="radiogroup" aria-label="Select a star rating"></div>
    <div id="kbdHint" class="kbd-hint hidden">Press 1–5 or use arrow keys, Enter to save.</div>

    <div id="status" class="status" aria-live="polite"></div>
    <div id="liveAnnouncer" class="visually-hidden" aria-live="polite"></div>
    <div class="footer-logo">
      <!-- Full inline logo -->
        <svg role="img" aria-label="Brand Logo" width="100%" height="100%" viewBox="0 0 158 40" xmlns="http://www.w3.org/2000/svg" style="max-width:170px;width:28%;min-width:120px;display:block;">
            <g transform="matrix(1,0,0,1,-491,-429)">
                <path d="M497.906,455.938C498.112,455.848 499.257,455.207 499.257,455.207C499.604,455.002 499.926,454.783 500.249,454.538C500.047,454.472 499.846,454.412 499.648,454.356C498.269,453.836 493.448,453.582 492.993,455.494C492.942,455.708 493.105,455.931 493.246,456.082C494.081,456.982 496.91,456.368 497.906,455.938ZM514.567,440.521C516.85,439.772 518.651,438.818 519.433,438.369C519.924,438.044 520.41,437.728 520.929,437.445C523.035,436.297 525.03,434.204 526.262,432.172C526.404,431.939 526.644,431.276 526.49,431.02C525.786,429.842 521.007,433.06 520.244,433.638C519.598,434.129 518.902,434.69 518.323,435.259C517.85,435.723 517.427,436.284 517.038,436.821C516.626,437.388 514.844,440.082 514.567,440.521ZM503.429,455.796C503.02,455.61 502.579,455.418 502.126,455.231C501.481,455.558 500.838,455.844 500.289,456.05C498.122,456.848 494.994,457.922 492.993,456.622C492.896,456.477 492.723,456.412 492.705,456.226C492.553,456.003 492.423,455.714 492.537,455.446C492.49,455.233 492.651,455.03 492.753,454.857C493.808,453.072 497.406,453.152 499.167,453.464C499.303,453.488 499.455,453.522 499.612,453.558C500.08,453.626 500.55,453.749 501.018,453.904C501.482,453.494 501.985,453.012 502.591,452.42C504.995,449.906 508.848,444.966 509.604,444.012C509.711,443.877 509.858,443.705 510.016,443.518C510.352,443.084 510.773,442.52 511.262,441.887C510.254,442.081 509.5,442.188 509.223,442.202C509.06,442.21 508.845,442.208 508.625,442.197C507.454,442.246 506.27,442.318 505.123,442.096C502.435,441.572 498.97,440.552 497.844,437.736C497.679,437.323 497.651,436.863 497.604,436.427C497.656,436.255 497.606,436.099 497.64,435.922C497.749,435.345 497.996,434.77 498.409,434.349C500.71,432.001 504.835,431.269 507.969,431.947C508.22,432.001 509.762,432.375 509.819,432.584C509.834,432.641 509.723,432.728 509.674,432.728C509.191,432.727 508.681,432.629 508.198,432.596C506.642,432.49 505.062,432.416 503.526,432.704C501.577,433.07 497.873,434.03 498.18,436.691C498.227,437.096 498.447,437.852 498.648,438.205C499.358,439.444 501.135,440.305 502.42,440.786C504.655,441.623 507.299,441.847 509.662,441.53L509.92,441.499L510.238,441.477C510.752,441.423 511.258,441.347 511.755,441.253C512.183,440.708 514.597,437.902 516.269,436.196C517.639,434.798 525.065,428.257 526.995,430.395C527.439,430.888 527.431,431.552 527.211,432.148C526.302,434.616 522.965,437.172 519.898,438.91L519.814,438.966C518.339,439.933 516.143,440.69 514.123,441.23C513.408,442.38 513.03,443.027 512.727,443.506C512.71,443.534 512.689,443.56 512.664,443.588C512.46,443.964 512.282,444.304 512.163,444.529C511.531,445.714 510.799,446.902 510.024,447.999C508.598,450.019 507.017,451.987 505.004,453.452L504.742,453.638C504.286,453.994 503.692,454.374 503.056,454.733C503.493,454.934 503.896,455.129 504.245,455.288C505.935,455.997 509.406,457.028 510.168,457.211C511.132,457.442 512.12,457.523 513.111,457.536C513.896,457.544 514.674,457.365 515.453,457.355C515.49,457.354 515.615,457.41 515.597,457.463C515.455,457.879 512.389,458.244 512.271,458.339C511.59,458.347 509.606,458.287 509.016,458.099C507.674,457.675 506.393,457.112 505.1,456.562C504.621,456.358 504.152,456.122 503.677,455.899C503.597,455.868 503.514,455.834 503.429,455.796ZM518.66,446.33C517.807,445.846 515.341,448.214 514.124,449.453C514.061,449.496 514.001,449.548 513.946,449.611C513.622,449.975 513.085,450.45 513.085,450.45C513.085,450.45 514.058,450.23 514.566,450.003C516.132,449.325 518.676,447.248 518.708,446.414L518.66,446.33ZM526.094,447.398C525.155,446.319 519.655,451.775 518.876,452.732C518.612,453.056 516.781,455.008 517.351,455.349C518,455.739 520.864,453.269 521.507,452.887C522.196,452.478 525.115,449.704 525.602,449.008C525.758,448.786 525.951,448.452 526.058,448.204C526.155,447.98 526.278,447.609 526.094,447.398ZM537.3,447.579C537.218,447.38 536.892,447.298 536.7,447.326C534.928,447.59 530.334,452.415 529.013,453.824C528.826,454.024 527.74,455.198 528.196,455.446C529.378,456.084 537.938,449.108 537.3,447.579ZM528.557,458.892C527.684,459.03 523.272,462.693 522.528,463.468C522.166,463.845 519.935,466.454 520.473,466.879C521.414,467.618 525.665,462.389 526.407,461.63C527.106,460.751 528.018,459.824 528.557,458.892ZM517.615,458.832C517.397,458.595 515.675,459.92 515.394,460.154C513.342,461.847 511.144,463.271 509.736,465.606C509.613,465.81 509.362,466.394 509.4,466.627C509.414,466.716 509.534,466.788 509.616,466.794C510.273,466.85 512.378,464.976 512.847,464.44C513.467,463.731 517.613,459.304 517.615,458.832ZM548.951,446.534C548.105,446.255 545.496,448.575 544.462,449.747C544.142,450.109 543.74,450.521 543.74,450.521C543.74,450.521 544.125,450.497 544.893,450.191L545.38,449.994C546.898,449.217 549.154,447.366 549.095,446.678C549.089,446.607 549.018,446.556 548.951,446.534ZM552.995,456.129C552.722,455.878 552.552,455.476 552.486,455.067L552.467,454.922C552.456,454.814 552.452,454.708 552.456,454.604C552.472,454.261 552.584,454.112 552.584,454.112C552.584,454.112 552.037,454.414 551.728,454.618L551.49,454.77C550.087,455.718 547.866,457.073 546.839,456.129C546.567,455.878 546.396,455.476 546.33,455.067L546.312,454.922C546.3,454.814 546.296,454.708 546.3,454.604C546.316,454.261 546.428,454.112 546.428,454.112C546.428,454.112 545.881,454.414 545.573,454.618C545.109,454.911 544.5,455.318 543.891,455.665C543.356,455.972 542.85,456.24 542.525,456.334C540.505,456.92 538.687,455.127 539.582,453.14C539.663,452.962 539.647,452.726 539.764,452.575L539.679,452.431C539.58,452.429 538.556,452.986 537.714,453.456C537.205,453.74 536.749,454 536.628,454.076C535.542,454.758 534.322,455.242 533.241,455.938C532.444,456.451 531.912,457.382 531.319,458.099C529.28,460.568 525.461,465.658 522.575,467.191C521.945,467.526 520.892,468 520.21,467.599C519.377,467.111 519.66,465.994 520.041,465.318C520.984,463.644 522.346,462.484 523.789,461.258C524.805,460.395 525.901,459.683 526.984,458.916C527.924,458.25 529.652,457.406 530.37,456.743C530.976,456.183 532.197,454.783 532.496,454.04L532.352,453.992C531.058,454.666 529.604,456.285 528.088,456.394C527.538,456.433 527.034,455.902 526.852,455.422C526.585,454.722 527.023,453.924 527.212,453.259C527.185,453.204 527.124,453.138 527.056,453.151C527.037,453.155 526.793,453.284 526.424,453.483C525.147,454.172 522.493,455.636 522.228,455.805C521.864,456.037 521.46,456.442 521.043,456.931C519.994,458.168 518.832,459.966 518.095,460.886C516.478,462.906 514.037,465.676 511.778,466.95C511.183,467.286 510.084,467.783 509.412,467.515C509.151,467.412 508.823,467.114 508.763,466.831C508.2,464.136 513.792,460.443 515.706,459.108C515.986,458.912 516.291,458.736 516.582,458.556C517.799,457.8 518.876,457.054 519.787,456.136C520.373,455.546 520.895,454.872 521.362,454.052L521.569,453.694C521.486,453.739 521.336,453.831 521.119,453.972C520.082,454.65 518.656,455.973 517.471,456.238C516.579,456.437 515.952,455.376 516.018,454.604C516.031,454.453 516.214,453.7 515.79,453.944C515.505,454.108 515.178,454.354 514.906,454.558C514.672,454.733 514.437,454.906 514.192,455.049C512.867,455.824 510.648,456.882 509.448,455.362C509.108,454.931 508.984,454.558 508.944,454.028C508.924,453.774 509.034,452.871 509.315,452.382C509.589,451.908 509.798,451.469 510.108,451.014C510.863,449.904 511.922,448.81 513.015,448.035C514.248,447.161 516.64,445.632 518.144,445.501C518.693,445.454 519.424,445.598 519.632,446.186C520.066,447.407 518.462,448.651 517.639,449.272C516.464,450.158 514.872,450.699 513.448,451.026L513.302,451.054C513.277,451.052 513.247,451.054 513.212,451.061C512.879,451.127 512.426,451.181 512.426,451.181C512.426,451.181 512.294,451.303 512.124,451.469C512.036,451.55 511.937,451.65 511.831,451.765C511.742,451.859 511.656,451.954 511.584,452.041C511.521,452.116 511.467,452.182 511.425,452.24C510.68,453.174 509.884,454.507 510.288,455.061C511.008,456.046 513.128,454.863 514.691,453.836C515.382,453.381 515.97,452.954 516.27,452.767C516.887,452.38 517.309,451.632 517.783,451.086C518.732,449.994 519.94,448.858 521.182,448.108C522.103,447.551 525.435,445.74 526.407,446.51C526.614,446.673 526.834,447.276 526.876,447.314C527.138,447.558 527.654,446.522 528.316,446.522C528.493,446.522 529.888,446.254 529.65,446.786C529.464,447.203 527.498,449.141 527.032,449.692C526.379,450.462 523.636,453.576 523.344,454.232L523.44,454.316C524.182,454.063 525.383,453.437 526.48,452.786C527.336,452.278 528.134,451.75 528.617,451.362C529.34,450.782 530.031,450.082 530.719,449.452C532.096,448.193 535.194,446.248 537.108,446.462C537.874,446.548 537.791,447.37 538.117,447.458C538.475,447.319 538.738,446.96 539.042,446.738C539.228,446.603 540.648,446.46 540.736,446.762C540.785,446.931 540.523,447.18 540.423,447.29C538.374,449.581 536.17,451.819 534.406,454.34L534.49,454.461C534.988,454.349 535.392,454.158 535.811,453.872C536.379,453.484 537.026,453.198 537.629,452.864C537.836,452.748 538.041,452.626 538.238,452.49C538.791,452.109 539.407,451.859 539.943,451.446C540.226,451.227 540.503,451.044 540.796,450.845C541.213,450.562 541.525,450.052 541.889,449.704C542.93,448.711 543.921,447.927 545.096,447.122C546.062,446.46 549.359,444.749 550.05,446.428C550.093,446.536 550.127,446.658 550.146,446.819C550.167,446.993 550.127,447.229 550.127,447.229C550.069,447.453 549.991,447.607 549.876,447.795C549.348,448.652 548.257,449.562 547.378,450.04C546.744,450.387 546.141,450.707 545.478,450.892C544.208,451.246 542.902,451.443 542.902,451.443L542.67,451.698C542.113,452.278 539.178,455.795 541.697,455.662C542.282,455.63 543.059,455.292 543.702,454.932C544.054,454.73 544.381,454.54 544.521,454.471C546.074,453.7 549.56,450.174 552.368,447.173L550.765,447.173C550.618,447.173 550.586,447.092 550.694,446.992L551.23,446.491C551.336,446.391 551.543,446.31 551.69,446.31L553.172,446.31C554.969,444.366 556.337,442.814 556.459,442.676C556.632,442.486 557.849,441.19 557.961,441.128C558.102,441.043 558.254,440.994 558.368,440.994L560.094,440.994C560.241,440.994 560.273,441.075 560.167,441.175L560.038,441.317C559.739,441.767 557.752,443.86 555.449,446.31L556.174,446.31C556.32,446.31 556.352,446.391 556.246,446.491L555.71,446.992C555.603,447.092 555.396,447.173 555.249,447.173L554.638,447.173C551.149,450.894 547.312,455.068 547.56,455.54C547.815,456.031 549.638,455.129 550.844,454.408C552.816,453.133 555.842,450.038 558.524,447.173L556.655,447.173C556.508,447.173 556.476,447.092 556.583,446.992L557.119,446.491C557.226,446.391 557.433,446.31 557.58,446.31L559.328,446.31C561.124,444.366 562.492,442.814 562.615,442.676C562.787,442.486 564.006,441.19 564.117,441.128C564.258,441.043 564.41,440.994 564.524,440.994L566.25,440.994C566.396,440.994 566.429,441.075 566.322,441.175L566.192,441.317C565.894,441.767 563.909,443.86 561.604,446.31L563.726,446.31C563.872,446.31 563.904,446.391 563.796,446.491L563.261,446.992C563.154,447.092 562.947,447.173 562.8,447.173L560.793,447.173C557.305,450.894 553.469,455.068 553.715,455.54C553.859,455.814 554.465,455.653 555.177,455.331C556.271,454.807 557.559,453.922 558.117,453.51C558.658,453.112 559.407,452.408 559.967,452.117C560.026,452.086 560.139,452.073 560.182,452.141C560.267,452.272 560.224,452.433 560.182,452.573C560.007,453.171 557.993,454.545 556.376,455.479C556.084,455.656 555.782,455.826 555.482,455.971C554.52,456.439 553.576,456.664 552.995,456.129ZM634.565,456.129C634.292,455.878 634.123,455.476 634.057,455.067L634.038,454.922C634.027,454.814 634.023,454.708 634.027,454.604C634.043,454.261 634.154,454.112 634.154,454.112C634.154,454.112 633.608,454.414 633.299,454.618L633.06,454.77C631.658,455.718 629.436,457.073 628.41,456.129C628.137,455.878 627.967,455.476 627.901,455.067L627.882,454.922C627.871,454.814 627.867,454.708 627.87,454.604C627.887,454.261 627.998,454.112 627.998,454.112C627.998,454.112 627.452,454.414 627.144,454.618C626.68,454.911 626.071,455.318 625.462,455.665C624.776,456.055 624.085,456.372 623.605,456.357C623.165,456.344 622.664,455.95 622.512,455.54C622.448,455.364 622.515,454.944 622.54,454.608C622.618,454.203 622.718,453.877 622.718,453.877C622.718,453.877 622.068,454.308 621.787,454.508C621.729,454.549 621.691,454.592 621.666,454.636C620.658,455.432 619.396,456.601 618.093,456.273C617.447,456.11 617.317,455.504 617.332,454.902C617.344,454.855 617.351,454.796 617.353,454.724C617.367,454.068 617.618,453.245 617.618,453.245C617.618,453.245 616.968,453.677 616.688,453.877C616.66,453.896 616.637,453.917 616.617,453.936C615.12,455.004 612.515,457.135 611.318,455.84C610.738,455.212 610.859,454.179 611.198,453.486C613.708,448.366 622.11,440.447 626.776,437.165C627.532,436.633 631.226,433.901 631.857,435.52C632.599,437.424 621.894,445.238 620.928,445.944C619.155,447.237 617.097,448.488 615.558,450.052C614.73,450.893 613.907,452.038 613.288,453.042C612.997,453.515 612.19,454.658 612.268,455.215C612.346,455.778 613.365,455.266 613.612,455.156C615.532,454.292 617.237,452.713 618.897,451.432C619.172,451.22 619.316,450.941 619.594,450.724C620.028,450.383 620.387,449.906 620.818,449.559C622.655,448.086 624.642,446.698 626.944,446.112C628.194,445.794 628.815,446.752 629.094,446.688C629.31,446.64 629.669,446.344 629.904,446.264C630.127,446.188 631.27,446.162 631.508,446.196C632.446,446.181 631.382,446.978 630.391,447.925C628.73,449.514 625.944,452.057 624.542,454.051C624.404,454.247 623.673,455.268 624.062,455.408C624.219,455.464 624.772,455.19 625.269,454.922C625.624,454.73 625.951,454.54 626.092,454.471C627.645,453.7 631.13,450.174 633.939,447.173L632.336,447.173C632.189,447.173 632.157,447.092 632.264,446.992L632.8,446.491C632.907,446.391 633.114,446.31 633.26,446.31L634.742,446.31C636.54,444.366 637.907,442.814 638.03,442.676C638.202,442.486 639.42,441.19 639.531,441.128C639.672,441.043 639.825,440.994 639.939,440.994L641.665,440.994C641.812,440.994 641.844,441.075 641.737,441.175L641.608,441.317C641.309,441.767 639.323,443.86 637.019,446.31L637.744,446.31C637.89,446.31 637.922,446.391 637.816,446.491L637.28,446.992C637.174,447.092 636.965,447.173 636.82,447.173L636.208,447.173C632.72,450.894 628.884,455.068 629.131,455.54C629.386,456.031 631.208,455.129 632.414,454.408C634.387,453.133 637.413,450.038 640.094,447.173L638.226,447.173C638.08,447.173 638.048,447.092 638.154,446.992L638.69,446.491C638.798,446.391 639.004,446.31 639.15,446.31L640.898,446.31C642.695,444.366 644.062,442.814 644.186,442.676C644.358,442.486 645.576,441.19 645.687,441.128C645.828,441.043 645.98,440.994 646.095,440.994L647.822,440.994C647.968,440.994 648,441.075 647.894,441.175L647.764,441.317C647.465,441.767 645.479,443.86 643.176,446.31L645.296,446.31C645.443,446.31 645.474,446.391 645.367,446.491L644.832,446.992C644.725,447.092 644.518,447.173 644.372,447.173L642.364,447.173C638.876,450.894 635.04,455.068 635.286,455.54C635.43,455.814 636.036,455.653 636.748,455.331C637.843,454.807 639.129,453.922 639.687,453.51C640.228,453.112 640.978,452.408 641.537,452.117C641.596,452.086 641.71,452.073 641.753,452.141C641.837,452.272 641.794,452.433 641.753,452.573C641.577,453.171 639.563,454.545 637.946,455.479C637.654,455.656 637.352,455.826 637.053,455.971C636.09,456.439 635.147,456.664 634.565,456.129ZM628.215,447.102C627.742,445.919 623.998,449.14 623.507,449.576C622.351,450.6 619.231,453.639 618.786,455.004C618.473,455.97 620.097,454.912 620.264,454.812C621.856,453.868 623.323,452.37 624.612,451.053C625.539,450.105 627.104,448.893 627.843,447.906C627.98,447.722 628.311,447.341 628.215,447.102ZM620.974,444.232C620.158,445.065 619.251,445.858 618.535,446.778C618.357,446.997 618.236,447.155 618.236,447.155C618.236,447.155 618.652,446.894 619.314,446.422C620.174,445.828 621.248,445.084 621.862,444.496C622.614,443.775 623.536,443.126 624.348,442.466C625.165,441.801 630.678,436.999 630.654,436.377C630.642,436.076 629.862,436.558 629.752,436.618C628.683,437.196 627.572,438.228 626.654,439.031C624.704,440.736 622.788,442.376 620.974,444.232ZM575.231,449.711C574.738,450.22 572.898,448.854 571.29,449.782C569.616,450.75 566.988,454.958 569.086,456.496C570.309,457.392 573.306,456.271 574.089,455.109C574.389,454.664 574.637,454.104 574.763,453.583C573.854,453.193 573.011,453.136 572.023,453.182C571.303,453.214 570.8,454.102 571.338,454.671C571.399,454.736 571.667,454.886 571.741,454.771C571.293,453.914 572.872,453.318 572.78,454.559C572.75,454.964 572.341,455.2 572.051,455.295C570.634,455.76 570.316,454.276 570.648,453.238C570.994,452.152 572.485,451.744 573.5,451.692C575.582,451.586 577.834,452.704 579.865,452.364C581.845,452.032 581.325,450.043 580.046,450.467C580.491,452.008 578.304,452.329 578.304,450.851C578.304,449.14 581.984,449.604 581.846,451.5C581.824,451.809 581.666,452.14 581.522,452.412C580.556,454.244 578.209,454.396 576.443,453.884C576.22,454.247 576.042,454.678 575.752,454.995C574.133,456.769 571.377,458.264 568.936,458.058C567.744,457.956 566.228,456.837 565.851,455.691C565.49,454.587 565.48,454.138 565.875,452.954C566.634,450.684 568.357,449.444 570.641,448.893C570.81,448.853 571.744,448.732 571.744,448.502C571.744,448.205 571.49,448.043 571.506,447.465C571.55,445.866 573.628,444.597 575.003,444.198C576.481,443.768 578.144,443.526 579.241,444.894C579.501,445.22 579.694,445.829 579.589,446.24C579.34,447.213 577.64,448.366 576.96,447.176C576.223,445.89 579.106,445.861 578.844,445.243C578.1,443.48 574.173,445.712 573.56,447.519C573.036,449.064 575.486,448.531 575.231,449.711ZM618.186,435.094C618.477,434.881 618.911,434.617 619.38,434.342C619.16,434.001 618.86,433.632 618.45,433.234C617.294,432.142 616.208,431.937 614.547,431.741C610,431.207 603.899,434.851 601.432,438.538C601.09,439.052 600.709,439.827 600.663,440.449C600.623,440.997 600.633,441.596 601,442.034C603.829,445.412 612.129,439.381 612.914,436.077C613.477,435.528 613.276,436.954 613.094,437.29C612.602,438.197 610.622,440.239 609.779,440.88C608.422,441.913 606.938,442.698 605.347,443.295C604.373,443.66 603.42,443.766 602.392,443.535C601.247,443.278 600.023,442.033 599.895,440.844C599.775,439.736 600.415,438.097 601.024,437.181C601.693,436.174 603.186,434.566 604.314,433.795C607.205,431.82 609.848,431.086 613.322,430.901C614.587,430.833 615.69,431.072 616.693,431.449C617.536,431.766 618.264,432.256 618.89,432.834C619.226,433.172 619.638,433.584 619.981,433.997C620.318,433.808 620.649,433.625 620.941,433.469L621.1,433.387C621.247,433.309 623.407,432.272 624.52,432.379C624.978,432.423 625.39,432.555 624.608,432.775C621.817,433.561 620.544,434.316 620.318,434.439C620.458,434.642 620.568,434.838 620.631,435.019L620.672,435.128C621.064,436.307 621.394,437.152 621.117,438.431C620.861,439.619 620.469,440.82 619.796,441.841C617.575,445.217 613.761,447.4 609.754,447.738C609.47,447.753 609.207,447.766 608.936,447.772C608.528,448.408 608.069,449.095 607.564,449.809C606.819,450.79 606.062,451.782 605.155,452.614C601.391,456.069 597.172,457.298 592.112,457.298C590.031,457.298 588.235,456.655 586.682,455.736C584.943,454.708 584.288,451.715 585.05,449.925C586.132,447.372 589.9,444.967 592.112,444.123C594.654,443.154 599.386,442.748 601.588,444.58C601.994,444.919 602.302,445.321 602.548,445.793C603.154,446.95 602.588,448.608 601.816,449.552C600.163,451.572 596.089,452.996 593.552,453.01C593.026,453.014 592.058,453.022 591.703,452.579C591.628,452.484 591.596,452.312 591.739,452.266C592.554,452.244 593.348,452.468 594.165,452.398C596.164,452.228 597.832,451.568 599.594,450.656C600.936,449.962 602.466,448.273 602.284,446.657C602.17,445.64 601.275,444.802 600.351,444.472C594.797,442.489 582.446,447.866 586.106,454.355C586.558,455.156 587.609,455.829 588.436,456.157C591.981,457.567 596.084,456.121 599.078,454.128C600.837,452.956 602.152,451.458 603.654,450.008C603.846,449.824 604.343,449.315 604.792,448.824C604.84,448.775 604.893,448.715 604.95,448.649C605.207,448.362 605.432,448.096 605.55,447.92C605.68,447.765 605.805,447.615 605.918,447.488C605.61,447.415 605.367,447.324 605.223,447.218C604.599,446.757 604.048,446.14 605.179,446.734C605.479,446.892 605.861,447.002 606.286,447.073L606.418,446.926C606.554,446.858 608.237,444.852 608.481,444.58C609.097,443.896 609.756,443.234 610.344,442.526C611.336,441.331 612.302,440.072 613.358,438.935C614.463,437.747 616.118,436.534 617.454,435.608C617.687,435.446 617.938,435.274 618.186,435.094ZM619.983,436.154C619.971,435.672 619.851,435.266 619.654,434.838C619.315,435.062 618.421,435.672 617.67,436.293C614.889,438.592 612.019,442.197 610.224,445.559C609.977,445.997 609.582,446.713 609.345,447.097C609.537,447.071 609.722,447.043 609.896,447.011C610.754,446.939 613.002,446.152 613.562,445.901C616.043,444.788 618.432,441.477 619.483,439.043C619.744,438.438 620.009,437.134 619.983,436.154ZM644.165,454.531L644.165,452.163L644.896,452.163C645.207,452.163 645.33,452.181 645.458,452.247C645.658,452.346 645.78,452.558 645.78,452.808C645.78,453.1 645.647,453.289 645.33,453.459L645.957,454.531L645.402,454.531L644.854,453.544L644.654,453.544L644.654,454.531L644.165,454.531ZM644.654,453.167L644.817,453.167C645.098,453.186 645.268,453.058 645.268,452.826C645.268,452.626 645.171,452.552 644.903,452.552L644.794,452.552L644.654,452.552L644.654,453.167ZM644.982,451.231C646.114,451.231 647.058,452.187 647.058,453.35C647.058,454.513 646.114,455.462 644.951,455.462C643.789,455.462 642.84,454.513 642.84,453.35C642.84,452.163 643.782,451.231 644.982,451.231ZM644.976,451.596C644.002,451.596 643.235,452.369 643.235,453.35C643.235,454.312 644.008,455.097 644.951,455.097C645.895,455.097 646.662,454.312 646.662,453.35C646.662,452.394 645.895,451.596 644.976,451.596Z" style="fill-rule:nonzero;" />
                <path d="M630.666,462.042L630.666,463.073C630.666,463.2 630.674,463.272 630.587,463.272C630.453,463.272 630.445,463.058 630.309,462.796C630.11,462.391 629.857,462.248 629.364,462.248C628.983,462.248 628.904,462.328 628.904,462.59L628.904,464.058C628.904,464.154 628.968,464.184 629.11,464.184L629.308,464.184C629.618,464.184 629.817,464.121 629.928,463.955C630.054,463.772 630.015,463.518 630.158,463.518C630.237,463.518 630.237,463.558 630.237,463.662L630.237,464.948C630.237,465.09 630.222,465.17 630.143,465.17C630.008,465.17 630.024,464.94 629.92,464.725C629.785,464.431 629.642,464.415 629.277,464.415L629.062,464.415C628.928,464.415 628.904,464.487 628.904,464.621L628.904,465.893C628.904,466.518 629.023,466.782 629.515,466.782C630.063,466.782 630.341,466.558 630.492,466.066C630.587,465.742 630.563,465.583 630.714,465.583C630.809,465.583 630.818,465.621 630.818,465.742L630.818,466.774C630.818,467.044 630.825,467.059 630.587,467.059C630.087,467.059 629.554,467.012 628.991,467.012C628.34,467.012 627.966,467.044 627.888,467.044C627.737,467.044 627.664,467.018 627.664,466.933C627.664,466.845 627.784,466.862 627.895,466.821C628.118,466.75 628.126,466.616 628.126,466.385L628.126,462.621C628.126,462.439 628.118,462.328 627.991,462.28C627.856,462.232 627.681,462.272 627.681,462.129C627.681,462.066 627.729,462.042 627.84,462.042C627.936,462.042 628.364,462.073 629.142,462.073C629.483,462.073 629.992,462.058 630.666,462.042ZM625.761,462.049C626.191,462.049 626.23,461.772 626.35,461.772C626.414,461.772 626.436,461.811 626.436,461.883C626.436,462.239 626.373,462.662 626.373,463.161C626.373,463.32 626.358,463.383 626.246,463.383C626.103,463.383 626.103,463.177 626.04,462.851C625.952,462.439 625.77,462.265 625.396,462.265C625.246,462.265 625.238,462.328 625.238,462.51L625.238,466.4C625.238,466.599 625.246,466.718 625.381,466.758C625.532,466.804 625.691,466.79 625.691,466.924C625.691,466.98 625.635,467.012 625.532,467.012C625.468,467.012 625.261,466.996 624.904,466.996C624.602,466.996 624.373,467.018 624.229,467.018C624.078,467.018 623.999,466.996 623.999,466.907C623.999,466.821 624.119,466.837 624.229,466.798C624.452,466.726 624.46,466.59 624.46,466.362L624.46,462.429C624.46,462.304 624.468,462.256 624.324,462.256C623.96,462.256 623.768,462.479 623.54,462.922C623.396,463.2 623.364,463.383 623.261,463.383C623.214,463.383 623.182,463.335 623.182,463.297C623.182,463.28 623.206,462.946 623.309,462.304C623.364,461.953 623.372,461.787 623.5,461.787C623.602,461.787 623.619,461.868 623.658,461.922C623.745,462.034 623.848,462.049 624.024,462.049L625.761,462.049ZM620.329,464.597C620.282,464.758 620.266,464.861 620.266,464.9C620.266,464.948 620.322,464.994 620.393,464.994L621.036,464.994C621.139,464.994 621.195,464.955 621.195,464.916C621.195,464.892 621.195,464.844 621.171,464.765L620.829,463.558C620.798,463.431 620.782,463.359 620.726,463.359C620.679,463.359 620.655,463.439 620.615,463.582L620.329,464.597ZM619.9,466.131C619.869,466.266 619.853,466.4 619.853,466.527C619.853,466.694 619.924,466.766 620.099,466.814C620.274,466.862 620.4,466.821 620.4,466.941C620.4,467.004 620.361,467.035 620.274,467.035C620.226,467.035 620.051,467.012 619.75,467.012C619.655,467.012 619.528,467.028 619.385,467.028C619.146,467.028 619.075,467.028 619.075,466.924C619.075,466.814 619.202,466.845 619.321,466.798C619.448,466.742 619.528,466.583 619.607,466.321L620.822,462.153C620.869,462.001 620.885,461.916 620.972,461.916C621.052,461.916 621.084,461.97 621.116,462.09L622.283,466.044C622.41,466.465 622.465,466.71 622.608,466.79C622.726,466.862 622.886,466.828 622.886,466.933C622.886,467.012 622.846,467.018 622.751,467.018C622.688,467.018 622.441,467.012 622.028,467.012C621.624,467.012 621.401,467.028 621.354,467.028C621.266,467.028 621.21,466.996 621.21,466.941C621.21,466.845 621.306,466.862 621.45,466.828C621.608,466.79 621.64,466.75 621.64,466.623C621.64,466.551 621.631,466.48 621.608,466.393L621.37,465.48C621.314,465.28 621.282,465.218 621.012,465.218L620.433,465.218C620.147,465.218 620.131,465.218 620.068,465.464L619.9,466.131ZM615.472,462.614C615.472,462.429 615.464,462.328 615.337,462.28C615.202,462.232 615.027,462.272 615.027,462.129C615.027,462.066 615.074,462.034 615.186,462.034C615.242,462.034 615.368,462.049 615.574,462.049C615.837,462.049 616.186,462.025 616.631,462.025C617.838,462.025 618.425,462.375 618.425,463.239C618.425,463.844 618.068,464.208 617.29,464.494C617.528,464.566 617.583,464.717 617.679,464.922L618.314,466.328C618.425,466.568 618.56,466.734 618.679,466.79C618.798,466.845 618.934,466.821 618.934,466.924C618.934,466.988 618.886,467.018 618.791,467.018C618.552,467.018 618.338,467.004 618.147,467.004C617.973,467.004 617.861,467.018 617.814,467.018C617.718,467.018 617.718,466.948 617.686,466.876L616.878,465.018C616.742,464.701 616.686,464.573 616.408,464.573C616.354,464.573 616.298,464.583 616.25,464.606L616.25,466.424C616.25,466.623 616.265,466.75 616.408,466.79C616.592,466.845 616.758,466.804 616.758,466.941C616.758,467.004 616.702,467.035 616.583,467.035C616.472,467.035 616.265,467.018 615.964,467.018C615.606,467.018 615.36,467.044 615.234,467.044C615.083,467.044 615.011,467.018 615.011,466.933C615.011,466.845 615.13,466.862 615.242,466.821C615.464,466.75 615.472,466.616 615.472,466.385L615.472,462.614ZM616.25,462.605L616.25,463.916C616.25,464.225 616.25,464.359 616.536,464.359C617.186,464.359 617.56,463.955 617.56,463.239C617.56,462.59 617.21,462.208 616.639,462.208C616.274,462.208 616.25,462.319 616.25,462.605ZM610.356,464.558C610.356,463.844 610.562,463.193 610.864,462.756C611.237,462.225 611.737,461.929 612.245,461.929C612.682,461.929 613.118,462.137 613.484,462.534C613.936,463.025 614.198,463.717 614.198,464.542C614.198,466.09 613.317,467.155 612.317,467.155C611.88,467.155 611.451,466.948 611.078,466.551C610.618,466.066 610.356,465.369 610.356,464.558ZM612.19,462.145C611.658,462.145 611.197,462.963 611.197,464.44C611.197,466.003 611.784,466.941 612.357,466.941C612.896,466.941 613.341,466.121 613.341,464.63C613.341,463.073 612.753,462.145 612.19,462.145ZM606.818,462.621C606.818,462.439 606.81,462.328 606.683,462.28C606.548,462.232 606.373,462.272 606.373,462.129C606.373,462.066 606.436,462.034 606.556,462.034C606.643,462.034 606.762,462.042 606.897,462.042C607.072,462.042 607.414,462.018 607.913,462.018C608.969,462.018 609.502,462.486 609.502,463.416C609.502,464.256 608.938,464.852 608.231,464.852C607.937,464.852 607.755,464.758 607.691,464.758C607.589,464.758 607.596,464.844 607.596,464.994L607.596,466.424C607.596,466.623 607.604,466.742 607.739,466.782C607.89,466.828 608.041,466.814 608.041,466.948C608.041,467.004 607.993,467.035 607.89,467.035C607.826,467.035 607.619,467.018 607.262,467.018C606.96,467.018 606.723,467.044 606.579,467.044C606.428,467.044 606.358,467.018 606.358,466.933C606.358,466.845 606.476,466.862 606.588,466.821C606.81,466.75 606.818,466.616 606.818,466.385L606.818,462.621ZM607.596,464.09C607.596,464.422 607.628,464.59 607.937,464.59C608.39,464.59 608.715,464.138 608.715,463.352C608.715,462.614 608.39,462.2 607.89,462.2C607.619,462.2 607.596,462.319 607.596,462.59L607.596,464.09ZM602.269,462.614C602.269,462.429 602.262,462.328 602.135,462.28C602,462.232 601.825,462.272 601.825,462.129C601.825,462.066 601.872,462.034 601.983,462.034C602.04,462.034 602.166,462.049 602.372,462.049C602.634,462.049 602.983,462.025 603.429,462.025C604.636,462.025 605.223,462.375 605.223,463.239C605.223,463.844 604.866,464.208 604.087,464.494C604.326,464.566 604.381,464.717 604.476,464.922L605.111,466.328C605.223,466.568 605.358,466.734 605.477,466.79C605.596,466.845 605.732,466.821 605.732,466.924C605.732,466.988 605.683,467.018 605.588,467.018C605.35,467.018 605.136,467.004 604.945,467.004C604.77,467.004 604.66,467.018 604.612,467.018C604.517,467.018 604.517,466.948 604.484,466.876L603.675,465.018C603.54,464.701 603.484,464.573 603.206,464.573C603.151,464.573 603.096,464.583 603.048,464.606L603.048,466.424C603.048,466.623 603.063,466.75 603.206,466.79C603.389,466.845 603.556,466.804 603.556,466.941C603.556,467.004 603.5,467.035 603.382,467.035C603.271,467.035 603.063,467.018 602.762,467.018C602.404,467.018 602.158,467.044 602.031,467.044C601.881,467.044 601.809,467.018 601.809,466.933C601.809,466.845 601.928,466.862 602.04,466.821C602.262,466.75 602.269,466.616 602.269,466.385L602.269,462.614ZM603.048,462.605L603.048,463.916C603.048,464.225 603.048,464.359 603.333,464.359C603.984,464.359 604.358,463.955 604.358,463.239C604.358,462.59 604.008,462.208 603.436,462.208C603.072,462.208 603.048,462.319 603.048,462.605ZM596.994,464.558C596.994,463.844 597.2,463.193 597.502,462.756C597.874,462.225 598.374,461.929 598.882,461.929C599.319,461.929 599.756,462.137 600.122,462.534C600.573,463.025 600.836,463.717 600.836,464.542C600.836,466.09 599.954,467.155 598.955,467.155C598.518,467.155 598.089,466.948 597.716,466.551C597.255,466.066 596.994,465.369 596.994,464.558ZM598.827,462.145C598.296,462.145 597.835,462.963 597.835,464.44C597.835,466.003 598.422,466.941 598.994,466.941C599.534,466.941 599.978,466.121 599.978,464.63C599.978,463.073 599.391,462.145 598.827,462.145ZM595.89,465.861L595.882,466.496C595.882,466.638 595.89,466.734 595.834,466.798C595.7,466.964 595.271,467.147 594.739,467.147C594.182,467.147 593.73,466.907 593.35,466.416C592.968,465.924 592.753,465.28 592.753,464.527C592.753,462.97 593.612,461.938 594.802,461.938C595.311,461.938 595.651,462.081 595.731,462.184C595.754,462.215 595.779,462.319 595.779,462.486L595.794,463.239C595.794,463.344 595.779,463.399 595.683,463.399C595.533,463.399 595.501,463.217 595.39,462.899C595.207,462.399 595.032,462.161 594.667,462.161C594.008,462.161 593.572,462.922 593.572,464.297C593.572,466.003 594.064,466.917 594.715,466.917C595.057,466.917 595.366,466.631 595.493,466.116C595.604,465.654 595.588,465.352 595.771,465.352C595.906,465.352 595.897,465.512 595.89,465.861ZM591.268,466.804C591.268,466.996 591.268,467.092 591.156,467.092C591.093,467.092 591.03,467.044 590.982,466.964L589.004,463.422C588.886,463.208 588.798,463.105 588.758,463.105C588.711,463.105 588.711,463.145 588.711,463.232L588.734,466.362C588.734,466.583 588.806,466.71 588.933,466.75C589.124,466.804 589.306,466.774 589.306,466.917C589.306,467.004 589.219,467.028 589.021,467.028C588.972,467.028 588.79,467.018 588.472,467.018C588.378,467.018 588.282,467.035 588.187,467.035C588.052,467.035 587.989,467.004 587.989,466.924C587.989,466.798 588.108,466.79 588.266,466.766C588.457,466.734 588.489,466.686 588.489,466.407L588.496,462.534C588.496,462.375 588.464,462.28 588.346,462.256C588.179,462.225 588.036,462.232 588.036,462.114C588.036,462.049 588.108,462.018 588.25,462.018L588.957,462.018C589.14,462.018 589.132,462.129 589.219,462.287L590.728,465.058C590.846,465.273 590.958,465.376 590.998,465.376C591.053,465.376 591.053,465.335 591.053,465.25L591.014,462.725C591.014,462.501 590.974,462.375 590.831,462.335C590.64,462.28 590.45,462.311 590.45,462.167C590.45,462.081 590.544,462.058 590.743,462.058C590.791,462.058 590.966,462.066 591.283,462.066C591.378,462.066 591.474,462.058 591.569,462.058C591.704,462.058 591.768,462.09 591.768,462.167C591.768,462.296 591.649,462.296 591.49,462.319C591.299,462.35 591.268,462.399 591.268,462.677L591.268,466.804ZM586.448,466.424C586.448,466.623 586.455,466.742 586.59,466.782C586.741,466.828 586.892,466.814 586.892,466.948C586.892,467.004 586.845,467.035 586.741,467.035C586.678,467.035 586.472,467.018 586.114,467.018C585.812,467.018 585.574,467.044 585.431,467.044C585.281,467.044 585.209,467.018 585.209,466.933C585.209,466.845 585.328,466.862 585.44,466.821C585.661,466.75 585.67,466.616 585.67,466.385L585.67,462.621C585.67,462.439 585.661,462.328 585.534,462.28C585.4,462.232 585.225,462.272 585.225,462.129C585.225,462.066 585.273,462.042 585.384,462.042C585.431,462.042 585.654,462.058 586.051,462.058C586.281,462.058 586.503,462.042 586.71,462.042C586.852,462.042 586.916,462.073 586.916,462.137C586.916,462.225 586.829,462.232 586.678,462.256C586.448,462.287 586.448,462.359 586.448,462.605L586.448,466.424ZM633.388,462.899L633.388,466.273C633.388,466.671 633.515,466.852 633.896,466.852C634.785,466.852 635.277,466.044 635.277,464.487C635.277,462.963 634.642,462.121 633.872,462.121C633.483,462.121 633.388,462.375 633.388,462.899ZM632.625,462.693C632.625,462.446 632.586,462.335 632.404,462.335C632.34,462.335 632.268,462.35 632.181,462.35C632.094,462.35 632.038,462.304 632.038,462.248C632.038,462.081 632.633,461.929 633.721,461.929C634.388,461.929 634.88,462.073 635.316,462.47C635.833,462.939 636.135,463.645 636.135,464.44C636.135,466.035 635.254,467.068 633.88,467.068C633.61,467.068 633.26,467.028 632.847,467.028C632.586,467.028 632.395,467.044 632.268,467.044C632.117,467.044 632.046,467.018 632.046,466.941C632.046,466.821 632.236,466.876 632.404,466.821C632.61,466.75 632.625,466.638 632.625,466.385L632.625,462.693Z" style="fill-rule:nonzero;" />
            </g>
        </svg>
    </div>
  </div>
</div>
<script>// Service Worker registration for offline + install (register ASAP for faster control)
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js').catch(e=>console.warn('SW reg failed',e));
}
</script>
<script>(function(){
  const themeToggle=document.getElementById('themeToggle');
  const fsToggle=document.getElementById('fsToggle');
  const docEl=document.documentElement;

  // helper to build svg reliably on Safari/iOS
  function setButtonIcon(btn, pathDefs){
    const svgNS='http://www.w3.org/2000/svg';
    const svg=document.createElementNS(svgNS,'svg');
    svg.setAttribute('viewBox','0 0 24 24');
    svg.setAttribute('width','28');
    svg.setAttribute('height','28');
    svg.setAttribute('aria-hidden','true');
    pathDefs.forEach(def=>{
      const p=document.createElementNS(svgNS,'path');
      Object.entries(def).forEach(([k,v])=>p.setAttribute(k,v));
      svg.appendChild(p);
    });
    btn.replaceChildren(svg);
  }

  function themeIcon(){
    const light=docEl.classList.contains('theme-light');
    if(light){
      // moon icon
      setButtonIcon(themeToggle,[
        { d:"M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z", fill:"none", stroke:"currentColor", "stroke-width":"2", "stroke-linejoin":"round", "stroke-linecap":"round"}
      ]);
    } else {
      // sun icon
      setButtonIcon(themeToggle,[
        { d:"M12 1v2", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M12 21v2", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M4.22 4.22 5.64 5.64", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M18.36 18.36l1.42 1.42", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M1 12h2", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M21 12h2", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M4.22 19.78l1.42-1.42", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M18.36 5.64l1.42-1.42", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z", fill:"none", stroke:"currentColor", "stroke-width":"2"}
      ]);
    }
  }

  function fsIcon(){
    const fs=document.fullscreenElement||document.webkitFullscreenElement;
    if(fs){
      // collapse
      setButtonIcon(fsToggle,[
        { d:"M9 9l-4-4", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M5 5h5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M5 5v5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M15 15l4 4", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M19 19h-5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M19 19v-5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M9 15l-4 4", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M5 19h5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M5 19v-5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M15 9l4-4", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M19 5h-5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M19 5v5", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"}
      ]);
    } else {
      // expand
      setButtonIcon(fsToggle,[
        { d:"M8 3H5a2 2 0 0 0-2 2v3", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M3 16v3a2 2 0 0 0 2 2h3", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M16 3h3a2 2 0 0 1 2 2v3", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"},
        { d:"M21 16v3a2 2 0 0 1-2 2h-3", stroke:"currentColor", "stroke-width":"2", "stroke-linecap":"round"}
      ]);
    }
  }

  const storedTheme=localStorage.getItem('standalone-theme'); if(storedTheme==='light') docEl.classList.add('theme-light'); 
  themeIcon(); fsIcon();
  themeToggle.addEventListener('click',()=>{docEl.classList.toggle('theme-light');localStorage.setItem('standalone-theme',docEl.classList.contains('theme-light')?'light':'dark');themeIcon();});
  fsToggle.addEventListener('click',()=>{const fs=document.fullscreenElement||document.webkitFullscreenElement;if(!fs){const r=document.documentElement;(r.requestFullscreen||r.webkitRequestFullscreen).call(r);}else{(document.exitFullscreen||document.webkitExitFullscreen).call(document);} });
  document.addEventListener('fullscreenchange',fsIcon);

  const qs=new URLSearchParams(location.search); const idParam=qs.get('m')?.trim()||'';
  const heading=document.getElementById('headingMain');
  const subtitle=document.getElementById('subtitle');
  const yourLabel=document.getElementById('yourLabel');
  const idInputWrapper=document.getElementById('idInputWrapper');
  const idInput=document.getElementById('idInput');
  const startBtn=document.getElementById('startBtn');
  const starsContainer=document.getElementById('starsContainer');
  const avgLine=document.getElementById('avgLine');
  const avgStars=document.getElementById('avgStars');
  const averageBlock=document.getElementById('averageBlock');
  const liveAnnouncer=document.getElementById('liveAnnouncer');
  const statusDiv=document.getElementById('status');

  const STAR_COUNT=5; let currentId=''; let selected=0; let hoverVal=0; let pending=0;
  function storageKey(id){return `rating:mattress:${id}`}
  function loadAgg(id){try{const raw=localStorage.getItem(storageKey(id)); if(!raw) return {count:0,total:0,buckets:[0,0,0,0,0]}; const p=JSON.parse(raw); if(!Array.isArray(p.buckets)||p.buckets.length!==5) p.buckets=[0,0,0,0,0]; if(typeof p.count!=='number'||typeof p.total!=='number') return {count:0,total:0,buckets:[0,0,0,0,0]}; return p;}catch{return {count:0,total:0,buckets:[0,0,0,0,0]};} }
  function saveAgg(id,a){localStorage.setItem(storageKey(id),JSON.stringify(a))}
  function record(id,stars){const a=loadAgg(id); a.count++; a.total+=stars; a.buckets[stars-1]++; saveAgg(id,a); return a; }
  function fmtAvg(c,t){ if(c===0) return {txt:'--',v:0}; const v=t/c; return {txt:v.toFixed(2).replace(/\.00$/,'').replace(/(\.[0-9])0$/,'$1'),v}; }

  function buildStars(){
    starsContainer.innerHTML='';
    for(let i=1;i<=STAR_COUNT;i++){
      const b=document.createElement('button');
      b.className='star-btn'; b.type='button'; b.setAttribute('data-star',String(i));
      b.setAttribute('role','radio'); b.setAttribute('aria-label',`${i} star${i>1?'s':''}`);
      b.setAttribute('aria-checked','false');
      b.addEventListener('pointerenter',()=>{hoverVal=i; paintStars();});
      b.addEventListener('pointerleave',()=>{hoverVal=0; paintStars();});
      b.addEventListener('click',()=>{ if(!currentId){flash('Enter a name first.',true); return;} commitRating(i); });
      const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('aria-hidden','true'); svg.classList.add('star');
      const gBase=document.createElementNS('http://www.w3.org/2000/svg','g'); gBase.classList.add('star-base'); const baseUse=document.createElementNS('http://www.w3.org/2000/svg','use'); baseUse.setAttribute('href','#star-shape'); gBase.appendChild(baseUse);
      const gFill=document.createElementNS('http://www.w3.org/2000/svg','g'); gFill.classList.add('star-fill'); const fillUse=document.createElementNS('http://www.w3.org/2000/svg','use'); fillUse.setAttribute('href','#star-shape'); gFill.appendChild(fillUse);
      svg.append(gBase,gFill); b.append(svg); starsContainer.append(b);
    }
  }
  function commitRating(val){ selected=val; pending=0; const agg=record(currentId,val); flash('Saved!',false); updateUI(agg); setTimeout(()=>{selected=0; paintStars();},2600); paintStars(); if(kbdHint){kbdHint.classList.add('hidden');} }
  function paintStars(){
    [...starsContainer.children].forEach((b,idx)=>{
      const star=idx+1; const fill=b.querySelector('.star-fill');
      const active=(hoverVal? star<=hoverVal : (pending? star<=pending : (selected && star<=selected)));
      if(fill) fill.style.opacity=active?'1':'0';
      b.classList.toggle('on',selected && star<=selected);
      b.classList.toggle('pending',pending && star<=pending && !selected);
      b.setAttribute('aria-checked', selected===star ? 'true':'false');
      if(pending===star && !selected) b.setAttribute('aria-checked','true');
    });
  }

  let fractionalRenderRun=0;
  function renderFractional(v){
    avgStars.innerHTML='';
    fractionalRenderRun++; const run=fractionalRenderRun;
    for(let i=1;i<=STAR_COUNT;i++){
      const frac=Math.min(Math.max(v-(i-1),0),1);
      const wrap=document.createElement('div'); wrap.className='fraction-wrap'; wrap.dataset.frac=String(frac);
      const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 24 24');
      if(frac<=0){
        svg.innerHTML=`<use href='#star-shape' fill='none' stroke='var(--outline)' stroke-width='2'></use>`;
      } else if(frac>=1){
        svg.innerHTML=`<use href='#star-shape' fill='var(--accent)'></use><use href='#star-shape' fill='none' stroke='var(--accent)' stroke-width='2'></use>`;
      } else {
        const fw=(24*frac).toFixed(3); const cf=`clipF_${run}_${i}`;
        svg.innerHTML=`<defs><clipPath id='${cf}'><rect width='${fw}' height='24'></rect></clipPath></defs>
          <use href='#star-shape' fill='none' stroke='var(--outline)' stroke-width='2'></use>
          <g clip-path='url(#${cf})'>
            <use href='#star-shape' fill='var(--accent)'></use>
            <use href='#star-shape' fill='none' stroke='var(--accent)' stroke-width='2'></use>
          </g>`;
      }
      wrap.append(svg); avgStars.append(wrap);
    }
  }

  function updateUI(agg){ const {txt,v}=fmtAvg(agg.count,agg.total); heading.textContent=currentId; subtitle.classList.add('hidden'); yourLabel.classList.remove('hidden'); const ratingCount=agg.count?`with ${agg.count} Rating${agg.count===1?'':'s'}`:'be the first to rate'; avgLine.innerHTML=`${txt} out of 5 Stars <small>${ratingCount}</small>`; renderFractional(v); averageBlock.classList.remove('hidden'); starsContainer.classList.remove('hidden'); document.querySelector('.panel')?.classList.add('rating-active'); liveAnnouncer.textContent= agg.count ? `Average ${txt} stars from ${agg.count} rating${agg.count===1?'':'s'}.` : 'No ratings yet.'; }
  function flash(msg,err){ if(statusDiv){ statusDiv.textContent=msg; statusDiv.style.color= err ? 'var(--danger)' : 'var(--accent)'; if(!err) setTimeout(()=>{ if(statusDiv.textContent===msg) statusDiv.textContent=''; },2000); } if(liveAnnouncer){ liveAnnouncer.textContent=msg; } }
  function initId(id){ currentId=id; localStorage.setItem('last-product-name',id); buildStars(); updateUI(loadAgg(id)); paintStars(); }

  const last=localStorage.getItem('last-product-name'); if(!idParam){ idInputWrapper.classList.remove('hidden'); if(last) idInput.value=last; }
  if(idParam){ initId(idParam); }
  startBtn.addEventListener('click',()=>{ const val=idInput.value.trim(); if(!val){flash('Enter a name.',true);return;} const url=new URL(location.href); url.searchParams.set('m',val); history.replaceState({},'',url.toString()); idInputWrapper.classList.add('hidden'); initId(val); if(statusDiv){ statusDiv.textContent=''; statusDiv.style.color='var(--muted)'; } });

  const kbdHint=document.getElementById('kbdHint'); let hintShown=false; function showHint(){ if(hintShown||!kbdHint) return; kbdHint.classList.remove('hidden'); hintShown=true; }

  const topBar=document.querySelector('.top-bar'); let hideTopTimer=null; function scheduleHide(){ if(!topBar) return; clearTimeout(hideTopTimer); hideTopTimer=setTimeout(()=>{ topBar.classList.add('autohide'); },2600);} function showTopBar(){ if(!topBar) return; const wasHidden=topBar.classList.contains('autohide'); topBar.classList.remove('autohide'); clearTimeout(hideTopTimer); hideTopTimer=setTimeout(()=>{ topBar.classList.add('autohide'); }, wasHidden?3200:2600); }

  document.addEventListener('pointerdown',e=>{ if(e.clientY<90){ showTopBar(); }});
  document.addEventListener('mousemove',e=>{ if(e.clientY<50){ showTopBar(); }});
  topBar?.addEventListener('pointerenter',()=>{ clearTimeout(hideTopTimer); });
  topBar?.addEventListener('pointerleave',()=>{ scheduleHide(); });
  themeToggle.addEventListener('focus',showTopBar); fsToggle.addEventListener('focus',showTopBar);
  themeToggle.addEventListener('blur',scheduleHide); fsToggle.addEventListener('blur',scheduleHide);
  document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ showTopBar(); }});

  // Network status indicator
  const netStatus=document.getElementById('netStatus');
  function updateOnline(){ if(!netStatus) return; if(navigator.onLine){ netStatus.style.display='none'; } else { netStatus.style.display='block'; } }
  window.addEventListener('online',updateOnline); window.addEventListener('offline',updateOnline); updateOnline();

  // SW update toast
  const updateToast=document.getElementById('updateToast');
  navigator.serviceWorker?.addEventListener('message',evt=>{
    if(evt.data && evt.data.type==='sw:activated'){
      if(updateToast){ updateToast.textContent='Updated'; updateToast.style.display='block'; setTimeout(()=>{updateToast.style.display='none';},1800); }
    }
    if(evt.data && evt.data.type==='sw:version'){
  const vb=document.getElementById('verBadge'); if(vb){ vb.textContent='REV '+evt.data.version; }
    }
  });
  // If a waiting worker appears, prompt user
  if(navigator.serviceWorker){
    navigator.serviceWorker.getRegistration().then(reg=>{
      if(!reg) return; if(reg.waiting){ showUpdateToast(reg.waiting); }
      reg.addEventListener('updatefound',()=>{ const nw=reg.installing; if(!nw) return; nw.addEventListener('statechange',()=>{ if(nw.state==='installed' && reg.waiting){ showUpdateToast(reg.waiting); } }); });
    });
  }
  function showUpdateToast(sw){ if(!updateToast) return; updateToast.style.display='block'; updateToast.onclick=()=>{ sw.postMessage('sw:update'); location.reload(); } }
  // Request version from SW: handle first-load (Edge/Chromium) when page not yet controlled
  (function(){
    if(!('serviceWorker' in navigator)) return;
    function ask(){ try{ navigator.serviceWorker.controller && navigator.serviceWorker.controller.postMessage('sw:get-version'); }catch{} }
    if(navigator.serviceWorker.controller){ ask(); }
    navigator.serviceWorker.ready.then(()=>ask());
    navigator.serviceWorker.addEventListener('controllerchange',()=>{ setTimeout(ask,60); });
    // Fallback timeout: hide badge if still empty after 5s
    setTimeout(()=>{ const vb=document.getElementById('verBadge'); if(vb && /^(--)?$/.test(vb.textContent.trim())) vb.style.opacity='.25'; },5000);
    // Fetch sw.js and parse VERSION if badge still unknown (Safari/iPad fallback)
    function fetchVersionFallback(){
      const vb=document.getElementById('verBadge');
      if(!vb) return;
      if(vb.textContent && vb.textContent.trim()!=='--') return; // already filled
      fetch('/sw.js',{cache:'no-store'}).then(r=>r.text()).then(txt=>{
        const m=txt.match(/const\s+VERSION\s*=\s*['"]([^'"`]+)['"]/);
        if(m && (vb.textContent.trim()==='--' || vb.textContent.trim()==='')){
          vb.textContent='REV '+m[1]; vb.style.opacity='.55';
        }
      }).catch(()=>{});
    }
    setTimeout(fetchVersionFallback,2500);
    document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible') fetchVersionFallback(); });
    window.addEventListener('online',fetchVersionFallback);
  })();

  document.addEventListener('keydown',e=>{
    if(!currentId) return;
    if(['ArrowRight','ArrowUp','ArrowLeft','ArrowDown','1','2','3','4','5'].includes(e.key)) showHint();
    if(e.key>='1'&&e.key<='5'){ commitRating(Number(e.key)); return; }
    if(['ArrowRight','ArrowUp'].includes(e.key)){ e.preventDefault(); pending = pending? Math.min(5,pending+1) : 1; paintStars(); return; }
    if(['ArrowLeft','ArrowDown'].includes(e.key)){ e.preventDefault(); if(pending>1) pending--; else if(!pending) pending=5; else pending=0; paintStars(); return; }
    if(e.key==='Enter' && pending){ commitRating(pending); }
  });

  starsContainer.addEventListener('focusin',()=>{showHint();});
  // Allow changing product after initial selection (PWA lacks address bar to edit ?m=)
  function enterChangeMode(){
    if(!idInputWrapper) return;
    idInputWrapper.classList.remove('hidden');
    if(idInput){ idInput.value=currentId; idInput.focus(); }
    starsContainer.classList.add('hidden');
    averageBlock.classList.add('hidden');
    yourLabel.classList.add('hidden');
    document.querySelector('.panel')?.classList.remove('rating-active');
    statusDiv.textContent='Change product name';
  }
  // Triple-tap gesture within 1.2s
  let headingTapTimes=[]; heading.addEventListener('click',()=>{ const now=Date.now(); headingTapTimes=headingTapTimes.filter(t=> now - t < 1200); headingTapTimes.push(now); if(headingTapTimes.length>=3){ headingTapTimes=[]; enterChangeMode(); } });
  // Long-press (900ms) on heading
  let pressTimer=null; function cancelPress(){ if(pressTimer){ clearTimeout(pressTimer); pressTimer=null; } }
  ['touchstart','mousedown'].forEach(ev=> heading.addEventListener(ev,(e)=>{ if(ev==='mousedown' && e.button!==0) return; cancelPress(); pressTimer=setTimeout(()=>{ enterChangeMode(); },900); }, {passive:true}));
  ['touchend','touchcancel','mouseup','mouseleave','blur'].forEach(ev=> heading.addEventListener(ev,cancelPress));
  // Keyboard shortcut: Ctrl+Shift+C to change
  document.addEventListener('keydown',e=>{ if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='c'){ enterChangeMode(); }});
})();</script>
</body>
</html>